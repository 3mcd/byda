!function(t,e){function n(t){return t="string"==typeof t?(new DOMParser).parseFromString(t,"text/html"):e,t.nodeType?t.querySelectorAll(i()):void 0}function i(){return"[data-"+w+"]"}function o(t){if(v||g){var e=g["byda-"+t]||v[t];return e}}function s(t,e){g["byda-"+t]=e,v&&(v.byda[t]=e)}function r(t,n){if(t)if("string"==typeof t&&(t={file:t}),t.view&&(t.file="views/"+t.view+".html"),t.callback=n,t.json={req:"string"==typeof t.json?[{name:"default",file:t.json}]:t.json||[],res:{}},b&&j){var i=e.createElement("link"),o=t.file;d&&(o=d+"/"+o),i.rel="import",i.href=o;var s=e.querySelector('link[href="'+o+'"]');s&&s.remove(),i.onload=function(){t.import=i.import,a(t)},i.onerror=function(){u(t)},e.head.appendChild(i)}else a(t)}function a(t){var e,n=t.json.req[0],i=n?n.file:t.file;if(!i)return t.import?h(t.import,t):f(t);o&&o.readyState<4&&(o.onreadystatechange=E,o.abort());var o=new XMLHttpRequest;i=d?d+"/"+i:i,o.open("GET",i,!0),o.setRequestHeader("X-BYDA","true"),o.onreadystatechange=function(){if(4==o.readyState)if(n&&t.json.req.splice(0,1),200==o.status||0===o.status&&-1!=i.indexOf("file:///")){var s=o.responseText;if(!n)return h(s,t);e=JSON.parse(s),"default"==n.name?t.json.res=e:t.json.res[n.name]=e,a(t)}else n&&a(t),u(t)},o.send()}function h(t,e){r.flash().generate(r.flash({dom:t})).run(),f(e)}function u(t){throw new Error("Could not get: "+t.file)}function f(t){var e=r.flash();return y&&y(e,t)||t.callback&&t.callback(e,t.json?t.json.res:null)}function l(t,e,n){this.store=t,this.from=e,this.to=n}function c(t,e){this.name=t,this.list=[],this.changes=[],this.value=e||o(t)}function p(t){t||(t={}),this.dom=t.dom,this.list=this.dom?n(this.dom):n(),this.frozen=t.frozen,this.init()}var d,m,v,y,b,g={},w="load",j="import"in e.createElement("link"),E=function(){};l.prototype.swap=function(){if(this.from&&this.to){var t=this.to.nodeType?this.to.value||this.to.innerHTML:this.to;return t||(t=o(this.store)||""),this.from.hasAttribute("value")?this.from.value=t:this.from.innerHTML=t,this}},c.prototype.emit=function(){var n,i={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?n=new CustomEvent("byda",i):e.createEvent&&(n=e.createEvent("CustomEvent"),n.initCustomEvent("byda",i.bubbles,i.cancelable,i.detail)),t.dispatchEvent(n)},c.prototype.set=function(t,e){var n,i,r,a;for(e&&(r=e.cache),"function"==typeof t?t=t(this.value):"object"==typeof t&&(t=t[this.name]),t||(r=!0,t=o(this.name)),n=0,i=this.list.length;i>n;n++)a=this.list[n],a.hasAttribute("value")?a.value=t:a.innerHTML=t;this.value=t,r&&s(this.name,this.value),this.emit()},c.prototype.get=function(){return this.value},c.prototype.compare=function(t){var e,n;for(e=0,n=this.list.length;n>e;e++)this.changes.push(new l(this.name,this.list[e],t.list[e]))},c.prototype.commit=function(){var t,e;for(t=0,e=this.changes.length;e>t;t++)this.changes[t].swap()},p.prototype.init=function(){this.organize()},p.prototype.update=function(){return this.organize(this.dom?n(this.dom):n())},p.prototype.add=function(t,e){return"string"==typeof t&&e.nodeType&&this.find(t).list.push(e),this},p.prototype.find=function(t){return this.stores[t]},p.prototype.map=function(t){var e;for(var n in t)e=this.stores[n],e&&e.set(t[n]);return this},p.prototype.generate=function(t){var e;for(var n in this.stores)e=t.stores[n]||m.stores[n],e&&this.stores[n].compare(e);return this},p.prototype.organize=function(t){var e,n,i,o;for(this.stores={},t&&(this.list=t),e=0,n=this.list.length;n>e;e++)o=this.list[e].getAttribute("data-"+w),i=this.list[e],this.frozen&&(i=i.cloneNode(!0)),this.stores[o]||(this.stores[o]=new c(o,i.value||i.innerHTML)),this.add(o,i);return this},p.prototype.run=function(){for(var t in this.stores)this.stores[t].commit()},r.init=function(t){t&&(w="string"==typeof t?t:t.suffix=t.data||w,g=t.local,v=t.cache,v&&!v.byda&&(v.byda={}),b=t.imports,d=t.base,y=t.complete,t.freeze&&(m=r.flash({frozen:!0})))},r.base=function(t){return d=t||d},r.flash=function(t){return new p(t)},t.byda=r}(window,document);