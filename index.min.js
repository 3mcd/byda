!function(a,b){"use strict";function k(){}function m(a){return a="string"==typeof a?(new DOMParser).parseFromString(a,"text/html"):b,q(a)?a.querySelectorAll(n()):void 0}function n(){return"[data-"+i+"]"}function o(a){return f?f["byda-"+a]:g?g[a]:""}function p(a,b){f&&(f["byda-"+a]=b),g&&(g.byda[a]=b)}function q(a){return"object"==typeof a&&!!a.nodeType}function r(a,e){if(a&&!c)if("string"==typeof a&&(a={file:a}),a.view&&(a.file="views/"+a.view+".html"),a.callback=e||k,a.json={req:"string"==typeof a.json?[{name:"default",file:a.json}]:a.json||[],res:{}},h&&j){var f=b.createElement("link"),g=a.file;d&&(g=d+"/"+g),f.rel="import",f.href=g;var i=b.querySelector('link[href="'+g+'"]');i&&i.remove(),f.onload=function(){a.imp=f["import"],s(a)},f.onerror=function(){u(a)},b.head.appendChild(f)}else s(a)}function s(a){var c,b=a.json.req[0],e=b?b.file:a.file;if(!e)return a.imp?t(a.imp,a):_complete(a);f&&f.readyState<4&&(f.onreadystatechange=k,f.abort());var f=new XMLHttpRequest;e=d?d+"/"+e:e,f.open("GET",e,!0),f.setRequestHeader("X-BYDA","true"),f.onreadystatechange=function(){if(4==f.readyState)if(b&&a.json.req.splice(0,1),200==f.status||0===f.status&&-1!=e.indexOf("file:///")){var d=f.responseText;if(!b)return t(d,a);c=JSON.parse(d),"default"==b.name?a.json.res=c:a.json.res[b.name]=c,s(a)}else b&&s(a),u(a)},f.send()}function t(a,b){r.flash().generate(r.flash({dom:a})).run(function(){c=!0,b.callback(r.flash(),b.json.res)},function(){c=!1,l(b)})}function u(a){throw new Error("Could not get: "+a.file)}function v(a,b){this.name=a,this.list=[],this.changes=[],this.value=b||o(a)}function w(a){a||(a={}),this.dom=a.dom,this.list=this.dom?m(this.dom):m(),this.frozen=a.frozen,this.organize()}var c,d,f,g,h,e={},i="load",j="import"in b.createElement("link"),l=k;v.prototype.emit=function(){var c,d={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?c=new CustomEvent("byda",d):b.createEvent&&(c=b.createEvent("CustomEvent"),c.initCustomEvent("byda",d.bubbles,d.cancelable,d.detail)),a.dispatchEvent(c)},v.prototype.set=function(a,b){var c,d,e;for(b&&(d=b.cache),"function"==typeof a?a=a(this.value):"object"==typeof a&&(a=a[this.name]),a||(a=o(this.name)||""),c=this.list.length-1;c>=0;c--)e=this.list[c],e.hasAttribute("value")?e.value=a:e.innerHTML=a;return this.value=a,d&&p(this.name,this.value),this.emit(),this},v.prototype.get=function(){return this.value},v.prototype.compare=function(a){return this.to=a.list[0],this},v.prototype.commit=function(a){function c(){g&&b.set(g),a(b.name)}var b=this;if(!this.to)return c();var d,f,g=q(this.to)?this.to.value||this.to.innerHTML:this.to,h=this.list,i=this.name;if(g||(g=o(this.name)||""),"function"==typeof e[this.name])for(d=h.length-1;d>=0;d--)f=h[d].cloneNode(!0),f.innerHTML=g,e[i](h[d],f,c);else c()},w.prototype.update=function(){return this.organize(m(this.dom||null))},w.prototype.count=function(){var a=0;for(var b in this.stores)a++;return a},w.prototype.find=function(a){return this.stores[a]},w.prototype.map=function(a){var c;for(var d in a)c=this.stores[d],c&&c.set(a[d]);return this},w.prototype.generate=function(a){var b;for(var c in this.stores)b=a.stores[c],b&&this.stores[c].compare(b);return this},w.prototype.organize=function(a){var b,c,d;for(this.stores={},a&&(this.list=a),b=this.list.length-1;b>=0;b--)c=this.list[b],d=c.getAttribute("data-"+i),this.frozen&&(c=c.cloneNode(!0)),this.stores[d]||(this.stores[d]=new v(d,c.value||c.innerHTML)),this.stores[d].list.push(c);return this},w.prototype.run=function(a,b){function e(a){return d.push(a),c.count()==d.length?b&&b():void 0}var c=this,d=[];for(var f in this.stores)this.stores[f].commit(e);return a&&a()},r.init=function(a){a&&(i="string"==typeof a?a:a.suffix=a.data||i,e=a.animation,f=a.local,g=a.cache,g&&!g.byda&&(g.byda={}),h=a.imports,d=a.base,l=a.complete||k)},r.base=function(a){return d=a||d},r.flash=function(a){return new w(a)},a.byda=r}(window,document);