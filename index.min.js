!function(t,e){"use strict";function n(t){return t||(t=e),"string"==typeof t&&(t=(new DOMParser).parseFromString(t,"text/html")),t.nodeType?t.querySelectorAll(i()):void 0}function i(){return"[data-"+j+"]"}function o(t){if(v||b){var e=b?b["byda-"+t]:cache[t];return e||""}}function s(t,e){b&&(b["byda-"+t]=e),v&&(v.byda[t]=e)}function r(t,n){if(!t)return r.freeze();if("string"==typeof t&&(t={file:t}),t.view&&(t.file="views/"+t.view+".html"),"function"==typeof n&&(t.callback=n),t.json&&("string"==typeof t.json&&(t.json={"default":t.json}),t.json={req:t.json,res:{}}),g&&w){var i=e.createElement("link"),o=d?d+"/"+t.file:t.file;i.rel="import",i.href=o;var s=e.querySelector('link[href="'+o+'"]');s&&s.remove(),i.onload=function(){t.import=i.import,a(t)},i.onerror=function(){u(t)},e.head.appendChild(i)}else a(t)}function a(t){var e,n,i=t.file;if(t.json)if(e=Object.keys(t.json.req)[0])i=t.json.req[e];else if(!i)return t.import?f(t.import,t):h(t);o&&o.readyState<4&&(o.onreadystatechange=z,o.abort());var o=new XMLHttpRequest;i=d?d+"/"+i:i,o.open("GET",i,!0),o.setRequestHeader("X-BYDA","true"),o.onreadystatechange=function(){return 4==o.readyState?200==o.status||0===o.status&&-1!=i.indexOf("file:///")?e?(n=JSON.parse(o.responseText),"default"==e?t.json.res=n:t.json.res[e]=n,delete t.json.req[e],a(t)):(n=o.responseText,f(n,t)):e?(delete t.json.req[e],a(t)):u(t):void 0},o.send()}function f(t,e){var n=r.flash(),i=r.flash({dom:t});n.generate(i),n.run(),h(e)}function u(t){throw new Error("Could not get: "+t.file)}function h(t){"function"==typeof y&&y(r.flash(),t),t.callback&&t.callback(r.flash(),t.json?t.json.res:null)}function l(t){this.store=t.store,this.from=t.from,this.to=t.to}function c(t,e){this.name=t,this.list=e||[],this.changes=[],this.value=o(t)}function p(t){t||(t={}),this.stores=t.simulated||{},this.dom=t.dom,this.list=this.dom?n(this.dom):n(),this.frozen=t.frozen||!1,t.simulated||this.init()}var d,m,v,y,b={},g=!1,j="load",w="import"in e.createElement("link"),z=function(){};l.prototype.swap=function(){return this.from&&this.to?(this.from.hasAttribute("value")&&(this.from.value=this.to.value),this.from.innerHTML=this.to.nodeType?this.to.innerHTML:this.to,this):void 0},c.prototype.emit=function(){var n,i={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?n=new CustomEvent("byda",i):e.createEvent&&(n=e.createEvent("CustomEvent"),n.initCustomEvent("byda",i.bubbles,i.cancelable,i.detail)),t.dispatchEvent(n)},c.prototype.set=function(t){var e,n;for("function"==typeof t?t=t(this.value):"object"==typeof t&&(t=t[this.name]),t||(t=o(this.name)),e=0,n=this.list.length;n>e;e++)this.list[e].hasAttribute("value")&&(this.list[e].value=t),this.list[e].innerHTML=t;this.value=t,s(this.name,this.value),this.emit()},c.prototype.get=function(){return this.value},c.prototype.compare=function(t){var e,n,i;for(e=0,n=this.list.length;n>e;e++)i=new l({store:this.name,from:this.list[e],to:t.list[e]}),this.changes.push(i)},c.prototype.commit=function(){var t,e;for(t=0,e=this.changes.length;e>t;t++)this.changes[t].swap()},p.prototype.init=function(){this.organize()},p.prototype.update=function(){return this.list=this.dom?r.get(this.dom):r.get(),this.organize(),this},p.prototype.add=function(t,e){return"string"==typeof t&&e.nodeType&&this.find(t).list.push(e),this},p.prototype.find=function(t){return this.stores[t]},p.prototype.set=function(t,e){var n=this.find(t);if(n)return n.set(e),this},p.prototype.map=function(t){var e;for(var n in t)e=this.stores[n],e&&e.set(t[n]);return this},p.prototype.generate=function(t){var e;for(var n in this.stores){if(e=t.stores[n]||m.stores[n],!e)return;this.stores[n].compare(e)}return this},p.prototype.organize=function(t){var e,n,i,o;for(this.stores={},t||(t=this.list),e=0,n=t.length;n>e;e++)o=t[e].getAttribute("data-"+j),i=this.frozen?t[e].cloneNode(!0):t[e],this.stores[o]||(this.stores[o]=new c(o),this.set(o,i.innerHTML)),this.add(o,i);return this},p.prototype.run=function(){for(var t in this.stores)this.stores[t].commit()},r.init=function(t){if(t){if("string"==typeof t)return void(j=t);t.data&&(j=t.data),t.suffix&&(j=t.suffix),t.localCache&&(b=t.localCache),t.cache&&(v=t.cache,v.byda||(v.byda={})),t.imports&&(g=t.imports),t.base&&(d=t.base),"function"==typeof t.complete&&(y=t.complete),t.freeze&&this.freeze()}},r.base=function(t){return t&&(d=t),d},r.flash=function(t){return new p(t)},r.freeze=function(){return m=r.flash({frozen:!0})},"undefined"==typeof module&&(t.load||(t.load=r),t.byda=r)}(window,document);