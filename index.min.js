!function(a,b){"use strict";function m(a){return a="string"==typeof a?(new DOMParser).parseFromString(a,"text/html"):a||b,q(a)?a.querySelectorAll(n()):void 0}function n(){return"[data-"+k+"]"}function o(a){return g?g["byda-"+a]:h?h[a]:""}function p(a,b){g&&(g["byda-"+a]=b),h&&(h.byda[a]=b)}function q(a){return"object"==typeof a&&!!a.nodeType}function r(a,f){if(a&&!d)if("string"==typeof a&&(a={file:a}),a.view&&(a.file="views/"+a.view+".html"),a.callback=f||c,a.json={req:"string"==typeof a.json?[{name:"default",file:a.json}]:a.json||[],res:{}},i&&j){var g=e?e+"/"+a.file:a.file,h=b.querySelector('link[href="'+g+'"]');if(h)return a.imp=h["import"],s(a);var k=b.createElement("link");k.rel="import",k.href=g,k.onload=function(){a.imp=k["import"],s(a)},k.onerror=function(){u(a)},b.head.appendChild(k)}else s(a)}function s(a){var b,d=a.json.req[0],f=d?d.file:a.file;if(!f)return _complete(a);if(a.imp)return t(a.imp,a);g&&g.readyState<4&&(g.onreadystatechange=c,g.abort());var g=new XMLHttpRequest;f=e?e+"/"+f:f,g.open("GET",f,!0),g.setRequestHeader("X-BYDA","true"),g.onreadystatechange=function(){if(4==g.readyState)if(d&&a.json.req.splice(0,1),200==g.status||0===g.status&&-1!=f.indexOf("file:///")){var c=g.responseText;if(!d)return t(c,a);b=JSON.parse(c),"default"==d.name?a.json.res=b:a.json.res[d.name]=b,s(a)}else d&&s(a),u(a)},g.send()}function t(a,b){r.flash({dom:b.dom}).generate(r.flash({dom:a})).run(function(){d=!0,b.callback(r.flash(),b.json.res)},function(){d=!1,l(b)})}function u(a){throw new Error("Could not get: "+a.file)}function v(a,b){this.name=a,this.list=[],this.changes=[],this.value=b||o(a)}function w(a){a||(a={}),this.dom=a.dom,this.list=this.dom?m(this.dom):m(),this.frozen=a.frozen,this.organize()}var d,e,g,h,i,c=function(){},f={},j="import"in b.createElement("link"),k="load",l=c;v.prototype.emit=function(){var c,d={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?c=new CustomEvent("byda",d):b.createEvent&&(c=b.createEvent("CustomEvent"),c.initCustomEvent("byda",d.bubbles,d.cancelable,d.detail)),a.dispatchEvent(c)},v.prototype.set=function(a,b){var c,e;for("object"==typeof a&&(a=a[this.name]),a||(a=o(this.name)||""),c=this.list.length-1;c>=0;c--)e=this.list[c],e.hasAttribute("value")?e.value=a:e.innerHTML=a;return this.value=a,b&&b.cache&&p(this.name,this.value),this.emit(),this},v.prototype.get=function(){return this.value},v.prototype.compare=function(a){return"object"==typeof a&&v==a.constructor&&(this.to=a.list[0]),this},v.prototype.commit=function(a){function c(){return g&&b.set(g),a&&a(b.name)}var b=this;if(!this.to)return c();var d,e,g=q(this.to)?this.to.value||this.to.innerHTML:this.to,h=this.list,i=this.name;if(g||(g=o(i)||""),"function"==typeof f[i])for(d=h.length-1;d>=0;d--)e=h[d].cloneNode(!0),e.innerHTML=g,f[i](h[d],e,c);else c()},w.prototype.update=function(){return this.organize(m(this.dom))},w.prototype.count=function(){var a=0;for(var b in this.stores)a++;return a},w.prototype.find=function(a){return this.stores[a]},w.prototype.map=function(a){for(var c in a)this.stores[c]&&this.stores[c].set(a[c]);return this},w.prototype.generate=function(a){for(var b in this.stores)this.stores[b].compare(a.stores[b]);return this},w.prototype.organize=function(a){var b,c,d;for(this.stores={},a&&(this.list=a),b=this.list.length-1;b>=0;b--)c=this.list[b],d=c.getAttribute("data-"+k),this.frozen&&(c=c.cloneNode(!0)),this.stores[d]||(this.stores[d]=new v(d,c.value||c.innerHTML)),this.stores[d].list.push(c);return this},w.prototype.run=function(a,b){function e(a){return d.push(a),c.count()==d.length?b&&b():void 0}var c=this,d=[];for(var f in this.stores)this.stores[f].commit(e);return a&&a()},r.init=function(a){a&&(k="string"==typeof a?a:a.data||k,a.animation&&(f=a.animation),g=a.local,h=a.cache,h&&!h.byda&&(h.byda={}),i=a.imports,e=a.base,l=a.complete||c)},r.base=function(a){return"string"==typeof a&&(e=a),e},r.flash=function(a){return new w(a)},a.byda=r}(window,document);