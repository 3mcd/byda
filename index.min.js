!function(a,b){"use strict";function j(a){var d,b=[],c=[];if(a="string"==typeof a?(new DOMParser).parseFromString(a,"text/html"):a,l(a)){d=a.querySelectorAll(k());for(var e=d.length-1;e>=0;e--)/\^$/.test(d[e].getAttribute("data-"+h))?b.push(d[e]):c.push(d[e]);return c.filter(function(a){return b.every(function(b){return!b.contains(a)})})}}function k(){return"[data-"+h+"]"}function l(a){return"object"==typeof a&&!!a.nodeType}function m(a,e){if(a){if("function"==typeof a)return a.apply(m.flash());if("string"==typeof a&&(a={file:a}),a.view&&(a.file="views/"+a.view+".html"),a.callback=e||c,a.json={req:"string"==typeof a.json?[{name:"default",file:a.json}]:a.json||[],res:{}},f&&g){var h=d?d+"/"+a.file:a.file,i=b.querySelector('link[href="'+h+'"]');if(i)return a.imp=i["import"],n(a);var j=b.createElement("link");j.rel="import",j.href=h,j.onload=function(){a.imp=j["import"],n(a)},j.onerror=function(){p(a)},b.head.appendChild(j)}else n(a)}}function n(a){var b,e=a.json.req[0],f=e?e.file:a.file;if(!f)return o("",a);g&&g.readyState<4&&(g.onreadystatechange=c,g.abort());var g=new XMLHttpRequest;f=d?d+"/"+f:f,g.open("GET",f,!0),g.setRequestHeader("X-BYDA","true"),g.onreadystatechange=function(){if(4==g.readyState)if(e&&a.json.req.splice(0,1),200==g.status||0===g.status&&-1!=f.indexOf("file:///")){var c=g.responseText;if(!e)return o(c,a);b=JSON.parse(c),"default"==e.name?a.json.res=b:a.json.res[e.name]=b,n(a)}else e&&n(a),p(a)},g.send()}function o(a,b){m.flash({dom:b.dom,animations:b.animations}).generate(m.flash({dom:a})).run(function(){b.callback.apply(this.update(),[b.json.res])},function(){i(b)})}function p(a){throw new Error("Could not get: "+a.file)}function q(a,b,c){this.name=a,this.list=[],this.animation=c,this.value=b}function r(a){a||(a={}),this.dom=a.dom||b,this.list=j(this.dom),this.animations=a.animations||{},a.frozen&&(this.frozen=!0),this.organize()}var d,f,c=function(){},e={},g="import"in b.createElement("link"),h="load",i=c;q.prototype.emit=function(){var c,d={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?c=new CustomEvent("byda",d):b.createEvent&&(c=b.createEvent("CustomEvent"),c.initCustomEvent("byda",d.bubbles,d.cancelable,d.detail)),a.dispatchEvent(c)},q.prototype.set=function(a){var c,d;for("object"==typeof a&&(a=a[this.name]),a||(a=""),c=this.list.length-1;c>=0;c--)d=this.list[c],"value"in d?d.value=a:d.innerHTML=a;return this.value=a,this.emit(),this},q.prototype.get=function(){return this.value},q.prototype.compare=function(a){return"object"==typeof a&&(this.to=a.list[0]),this},q.prototype.commit=function(a){function c(){return d&&b.set(d),f&&f.parentNode&&f.parentNode.removeChild(f),a&&a(b.name)}var b=this;if(!this.to)return c();var f,g,d=l(this.to)?this.to.value||this.to.innerHTML:this.to,e=this.list;if(d||(d=""),"function"==typeof this.animation)for(var i=e.length-1;i>=0;i--)f=e[i],g=f.cloneNode(!0),f.setAttribute("data-"+h,"^"),g.innerHTML=d,this.animation(f,g,c);else c()},r.prototype.update=function(){return this.organize(j(this.dom))},r.prototype.count=function(){var a=0;for(var b in this.stores)a++;return a},r.prototype.find=function(a){return this.stores[a]},r.prototype.map=function(a){for(var c in a)this.stores[c]&&this.stores[c].set(a[c]);return this},r.prototype.condense=function(){var a={},b=this.stores;for(var c in b)a[c]=b[c].get();return a},r.prototype.generate=function(a){for(var b in this.stores)this.stores[b].compare(a.stores[b]);return this},r.prototype.organize=function(a){var b,c,d,f=this.stores={};for(a&&(this.list=a),b=this.list.length-1;b>=0;b--)c=this.list[b],d=c.getAttribute("data-"+h),this.frozen&&(c=c.cloneNode(!0)),f[d]||(f[d]=new q(d,c.value||c.innerHTML,this.animations[d]||e[d])),f[d].list.push(c);return this},r.prototype.run=function(a,b){function e(a){return d.push(a),c==d.length?b&&b():void 0}var c=this.count(),d=[];for(var f in this.stores)this.stores[f].commit(e);"function"==typeof a&&a.apply(this)},m.init=function(a){a&&(h="string"==typeof a?a:a.data||h,e=a.animations||e,f=a.imports,d=a.base,i=a.complete||c)},m.base=function(a){return"string"==typeof a&&(d=a),d},m.flash=function(a){return new r(a)},a.byda=m}(window,document);