!function(a,b){"use strict";function k(a){var d,b=[],c=[];if(a="string"==typeof a?(new DOMParser).parseFromString(a,"text/html"):a,m(a)){d=a.querySelectorAll(l());for(var e=d.length-1;e>=0;e--)/\^$/.test(d[e].getAttribute("data-"+i))?b.push(d[e]):c.push(d[e]);return c.filter(function(a){return b.every(function(b){return!b.contains(a)})})}}function l(){return"[data-"+i+"]"}function m(a){return"object"==typeof a&&!!a.nodeType}function n(a,f){if(a&&!e){if("function"==typeof a)return a.apply(n.flash());if("string"==typeof a&&(a={file:a}),a.view&&(a.file="views/"+a.view+".html"),a.callback=f||c,a.json={req:"string"==typeof a.json?[{name:"default",file:a.json}]:a.json||[],res:{}},g&&h){var i=d?d+"/"+a.file:a.file,j=b.querySelector('link[href="'+i+'"]');if(j)return a.imp=j["import"],o(a);var k=b.createElement("link");k.rel="import",k.href=i,k.onload=function(){a.imp=k["import"],o(a)},k.onerror=function(){q(a)},b.head.appendChild(k)}else o(a)}}function o(a){var b,e=a.json.req[0],f=e?e.file:a.file;if(!f)return p("",a);g&&g.readyState<4&&(g.onreadystatechange=c,g.abort());var g=new XMLHttpRequest;f=d?d+"/"+f:f,g.open("GET",f,!0),g.setRequestHeader("X-BYDA","true"),g.onreadystatechange=function(){if(4==g.readyState)if(e&&a.json.req.splice(0,1),200==g.status||0===g.status&&-1!=f.indexOf("file:///")){var c=g.responseText;if(!e)return p(c,a);b=JSON.parse(c),"default"==e.name?a.json.res=b:a.json.res[e.name]=b,o(a)}else e&&o(a),q(a)},g.send()}function p(a,b){n.flash({dom:b.dom,animations:b.animations}).generate(n.flash({dom:a})).run(function(){b.callback.apply(this.update(),[b.json.res])},function(){j(b)})}function q(a){throw new Error("Could not get: "+a.file)}function r(a,b,c){this.name=a,this.list=[],this.animation=c,this.value=b}function s(a){a||(a={}),this.dom=a.dom||b,this.list=k(this.dom),this.animations=a.animations||{},a.frozen&&(this.frozen=!0),this.organize()}var d,e,g,c=function(){},f={},h="import"in b.createElement("link"),i="load",j=c;r.prototype.emit=function(){var c,d={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?c=new CustomEvent("byda",d):b.createEvent&&(c=b.createEvent("CustomEvent"),c.initCustomEvent("byda",d.bubbles,d.cancelable,d.detail)),a.dispatchEvent(c)},r.prototype.set=function(a){var c,d;for("object"==typeof a&&(a=a[this.name]),a||(a=""),c=this.list.length-1;c>=0;c--)d=this.list[c],"value"in d?d.value=a:d.innerHTML=a;return this.value=a,this.emit(),this},r.prototype.get=function(){return this.value},r.prototype.compare=function(a){return"object"==typeof a&&(this.to=a.list[0]),this},r.prototype.commit=function(a){function c(){return d&&b.set(d),f&&f.parentNode&&f.parentNode.removeChild(f),a&&a(b.name)}var b=this;if(!this.to)return c();var f,g,d=m(this.to)?this.to.value||this.to.innerHTML:this.to,e=this.list;if(d||(d=""),"function"==typeof this.animation)for(var h=e.length-1;h>=0;h--)f=e[h],g=f.cloneNode(!0),f.setAttribute("data-"+i,"^"),g.innerHTML=d,this.animation(f,g,c);else c()},s.prototype.update=function(){return this.organize(k(this.dom))},s.prototype.count=function(){var a=0;for(var b in this.stores)a++;return a},s.prototype.find=function(a){return this.stores[a]},s.prototype.map=function(a){for(var c in a)this.stores[c]&&this.stores[c].set(a[c]);return this},s.prototype.condense=function(){var a={},b=this.stores;for(var c in b)a[c]=b[c].get();return a},s.prototype.generate=function(a){for(var b in this.stores)this.stores[b].compare(a.stores[b]);return this},s.prototype.organize=function(a){var b,c,d,e=this.stores={};for(a&&(this.list=a),b=this.list.length-1;b>=0;b--)c=this.list[b],d=c.getAttribute("data-"+i),this.frozen&&(c=c.cloneNode(!0)),e[d]||(e[d]=new r(d,c.value||c.innerHTML,this.animations[d]||f[d])),e[d].list.push(c);return this},s.prototype.run=function(a,b){function e(a){return d.push(a),c==d.length?b&&b():void 0}var c=this.count(),d=[];for(var f in this.stores)this.stores[f].commit(e);"function"==typeof a&&a.apply(this)},n.init=function(a){a&&(i="string"==typeof a?a:a.data||i,f=a.animations||f,g=a.imports,d=a.base,j=a.complete||c)},n.base=function(a){return"string"==typeof a&&(d=a),d},n.flash=function(a){return new s(a)},n.disable=function(){e=!0},n.enable=function(){e=!1},a.byda=n}(window,document);