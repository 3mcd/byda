!function(t,e){"use strict";function n(t){return t="string"==typeof t?(new DOMParser).parseFromString(t,"text/html"):t||e,s(t)?t.querySelectorAll(i()):void 0}function i(){return"[data-"+w+"]"}function o(t){return d?d["byda-"+t]:v?v[t]:""}function r(t,e){d&&(d["byda-"+t]=e),v&&(v.byda[t]=e)}function s(t){return"object"==typeof t&&!!t.nodeType}function a(t,n){if(t&&!p)if("string"==typeof t&&(t={file:t}),t.view&&(t.file="views/"+t.view+".html"),t.callback=n||b,t.json={req:"string"==typeof t.json?[{name:"default",file:t.json}]:t.json||[],res:{}},y&&j){var i=m?m+"/"+t.file:t.file,o=e.querySelector('link[href="'+i+'"]');if(o)return t.imp=o["import"],u(t);var r=e.createElement("link");r.rel="import",r.href=i,r.onload=function(){t.imp=r["import"],u(t)},r.onerror=function(){c(t)},e.head.appendChild(r)}else u(t)}function u(t){var e,n=t.json.req[0],i=n?n.file:t.file;if(!i)return _complete(t);if(t.imp)return f(t.imp,t);o&&o.readyState<4&&(o.onreadystatechange=b,o.abort());var o=new XMLHttpRequest;i=m?m+"/"+i:i,o.open("GET",i,!0),o.setRequestHeader("X-BYDA","true"),o.onreadystatechange=function(){if(4==o.readyState)if(n&&t.json.req.splice(0,1),200==o.status||0===o.status&&-1!=i.indexOf("file:///")){var r=o.responseText;if(!n)return f(r,t);e=JSON.parse(r),"default"==n.name?t.json.res=e:t.json.res[n.name]=e,u(t)}else n&&u(t),c(t)},o.send()}function f(t,e){p=!0,a.flash({dom:e.dom}).generate(a.flash({dom:t})).run(function(){e.callback(a.flash(),e.json.res)},function(){p=!1,E(e)})}function c(t){throw new Error("Could not get: "+t.file)}function h(t,e){this.name=t,this.list=[],this.changes=[],this.value=e||o(t)}function l(t){t||(t={}),this.dom=t.dom,this.list=this.dom?n(this.dom):n(),this.frozen=t.frozen,this.organize()}var p,m,d,v,y,b=function(){},g={},j="import"in e.createElement("link"),w="load",E=b;h.prototype.emit=function(){var n,i={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?n=new CustomEvent("byda",i):e.createEvent&&(n=e.createEvent("CustomEvent"),n.initCustomEvent("byda",i.bubbles,i.cancelable,i.detail)),t.dispatchEvent(n)},h.prototype.set=function(t,e){var n,i;for("object"==typeof t&&(t=t[this.name]),t||(t=o(this.name)||""),n=this.list.length-1;n>=0;n--)i=this.list[n],i.hasAttribute("value")?i.value=t:i.innerHTML=t;return this.value=t,e&&e.cache&&r(this.name,this.value),this.emit(),this},h.prototype.get=function(){return this.value},h.prototype.compare=function(t){return"object"==typeof t&&h==t.constructor&&(this.to=t.list[0]),this},h.prototype.commit=function(t){function e(){return a&&n.set(a),t&&t(n.name)}var n=this;if(!this.to)return e();var i,r,a=s(this.to)?this.to.value||this.to.innerHTML:this.to,u=this.list,f=this.name;if(a||(a=o(f)||""),"function"==typeof g[f])for(i=u.length-1;i>=0;i--)r=u[i].cloneNode(!0),r.innerHTML=a,g[f](u[i],r,e);else e()},l.prototype.update=function(){return this.organize(n(this.dom))},l.prototype.count=function(){var t=0;for(var e in this.stores)t++;return t},l.prototype.find=function(t){return this.stores[t]},l.prototype.map=function(t){for(var e in t)this.stores[e]&&this.stores[e].set(t[e]);return this},l.prototype.generate=function(t){for(var e in this.stores)this.stores[e].compare(t.stores[e]);return this},l.prototype.organize=function(t){var e,n,i;for(this.stores={},t&&(this.list=t),e=this.list.length-1;e>=0;e--)n=this.list[e],i=n.getAttribute("data-"+w),this.frozen&&(n=n.cloneNode(!0)),this.stores[i]||(this.stores[i]=new h(i,n.value||n.innerHTML)),this.stores[i].list.push(n);return this},l.prototype.run=function(t,e){function n(t){return o.push(t),i.count()==o.length?e&&e():void 0}var i=this,o=[];for(var r in this.stores)this.stores[r].commit(n);"function"==typeof t&&t()},a.init=function(t){t&&(w="string"==typeof t?t:t.data||w,t.animation&&(g=t.animation),d=t.local,v=t.cache,v&&!v.byda&&(v.byda={}),y=t.imports,m=t.base,E=t.complete||b)},a.base=function(t){return"string"==typeof t&&(m=t),m},a.flash=function(t){return new l(t)},t.byda=a}(window,document);