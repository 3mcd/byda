!function(t,e){"use strict";function n(){}function i(t){return t="string"==typeof t?(new DOMParser).parseFromString(t,"text/html"):e,a(t)?t.querySelectorAll(o()):void 0}function o(){return"[data-"+E+"]"}function s(t){var e=v?v["byda-"+t]:y?y[t]:"";return e}function r(t,e){v&&(v["byda-"+t]=e),y&&(y.byda[t]=e)}function a(t){return!!t.nodeType}function u(t,i){if(t&&!m)if("string"==typeof t&&(t={file:t}),t.view&&(t.file="views/"+t.view+".html"),t.callback=i||n,t.json={req:"string"==typeof t.json?[{name:"default",file:t.json}]:t.json||[],res:{}},g&&j){var o=e.createElement("link"),s=t.file;d&&(s=d+"/"+s),o.rel="import",o.href=s;var r=e.querySelector('link[href="'+s+'"]');r&&r.remove(),o.onload=function(){t.import=o.import,f(t)},o.onerror=function(){l(t)},e.head.appendChild(o)}else f(t)}function f(t){var e,i=t.json.req[0],o=i?i.file:t.file;if(!o)return t.import?h(t.import,t):_complete(t);s&&s.readyState<4&&(s.onreadystatechange=n,s.abort());var s=new XMLHttpRequest;o=d?d+"/"+o:o,s.open("GET",o,!0),s.setRequestHeader("X-BYDA","true"),s.onreadystatechange=function(){if(4==s.readyState)if(i&&t.json.req.splice(0,1),200==s.status||0===s.status&&-1!=o.indexOf("file:///")){var n=s.responseText;if(!i)return h(n,t);e=JSON.parse(n),"default"==i.name?t.json.res=e:t.json.res[i.name]=e,f(t)}else i&&f(t),l(t)},s.send()}function h(t,e){u.flash().generate(u.flash({dom:t})).run(function(){m=!0,e.callback(u.flash(),e.json.res)},function(){m=!1,b(e)})}function l(t){throw new Error("Could not get: "+t.file)}function c(t,e){this.name=t,this.list=[],this.changes=[],this.value=e||s(t)}function p(t){t||(t={}),this.dom=t.dom,this.numStores=0,this.list=this.dom?i(this.dom):i(),this.frozen=t.frozen,this.organize()}var m,d,v,y,b,g,w={},E="load",j="import"in e.createElement("link");c.prototype.emit=function(){var n,i={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?n=new CustomEvent("byda",i):e.createEvent&&(n=e.createEvent("CustomEvent"),n.initCustomEvent("byda",i.bubbles,i.cancelable,i.detail)),t.dispatchEvent(n)},c.prototype.set=function(t,e){var n,i,o;for(e&&(i=e.cache),"function"==typeof t?t=t(this.value):"object"==typeof t&&(t=t[this.name]),t||(t=s(this.name)||""),n=this.list.length-1;n>=0;n--)o=this.list[n],o.hasAttribute("value")?o.value=t:o.innerHTML=t;return this.value=t,i&&r(this.name,this.value),this.emit(),this},c.prototype.get=function(){return this.value},c.prototype.compare=function(t){this.to=t.list[0]},c.prototype.commit=function(t){function e(){t(n.name)}var n=this;if(!this.to)return e();var i,o,r=a(this.to)?this.to.value||this.to.innerHTML:this.to,u=this.list,f=this.name;if(r||(r=s(this.name)||""),"function"==typeof w[this.name])for(i=u.length-1;i>=0;i--)o=u[i].cloneNode(!0),o.innerHTML=r,w[f](o,u[i],e);else this.set(r),e()},p.prototype.update=function(){return this.organize(this.dom?i(this.dom):i())},p.prototype.find=function(t){return this.stores[t]},p.prototype.map=function(t){var e;for(var n in t)e=this.stores[n],e&&e.set(t[n]);return this},p.prototype.generate=function(t){var e;for(var n in this.stores)e=t.stores[n],e&&this.stores[n].compare(e);return this},p.prototype.organize=function(t){var e,n,i;for(this.stores={},t&&(this.list=t),e=this.list.length-1;e>=0;e--)n=this.list[e],i=n.getAttribute("data-"+E),this.frozen&&(n=n.cloneNode(!0)),this.stores[i]||(this.stores[i]=new c(i,n.value||n.innerHTML),this.numStores++),this.stores[i].list.push(n);return this},p.prototype.run=function(t,e){function i(t){s.push(t),o.numStores==s.length&&e()}var o=this,s=[];t=t||n,e=e||n;for(var r in this.stores)this.stores[r].commit(i);t()},u.init=function(t){t&&(E="string"==typeof t?t:t.suffix=t.data||E,w=t.buffer,v=t.local,y=t.cache,y&&!y.byda&&(y.byda={}),g=t.imports,d=t.base,b=t.complete||n)},u.base=function(t){return d=t||d},u.flash=function(t){return new p(t)},t.byda=u}(window,document);