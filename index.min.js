(function(x,f){function p(){}function r(a){a="string"==typeof a?(new DOMParser).parseFromString(a,"text/html"):f;if(y(a))return a.querySelectorAll("[data-"+s+"]")}function u(a){return q?q["byda-"+a]:g?g[a]:""}function y(a){return"object"==typeof a&&!!a.nodeType}function h(a,b){if(a&&!v)if("string"==typeof a&&(a={file:a}),a.view&&(a.file="views/"+a.view+".html"),a.callback=b||p,a.json={req:"string"==typeof a.json?[{name:"default",file:a.json}]:a.json||[],res:{}},z&&D){var c=f.createElement("link"),
d=a.file;k&&(d=k+"/"+d);c.rel="import";c.href=d;(d=f.querySelector('link[href="'+d+'"]'))&&d.remove();c.onload=function(b){a.imp=c["import"];t(a)};c.onerror=function(b){A(a)};f.head.appendChild(c)}else t(a)}function t(a){var b=a.json.req[0],c,d=b?b.file:a.file;if(!d)return a.imp?B(a.imp,a):_complete(a);e&&4>e.readyState&&(e.onreadystatechange=p,e.abort());var e=new XMLHttpRequest,d=k?k+"/"+d:d;e.open("GET",d,!0);e.setRequestHeader("X-BYDA","true");e.onreadystatechange=function(){if(4==e.readyState)if(b&&
a.json.req.splice(0,1),200==e.status||0===e.status&&-1!=d.indexOf("file:///")){var l=e.responseText;if(!b)return B(l,a);c=JSON.parse(l);"default"==b.name?a.json.res=c:a.json.res[b.name]=c;t(a)}else b&&t(a),A(a)};e.send()}function B(a,b){h.flash().generate(h.flash({dom:a})).run(function(){v=!0;b.callback(h.flash(),b.json.res)},function(){v=!1;C(b)})}function A(a){throw Error("Could not get: "+a.file);}function n(a,b){this.name=a;this.list=[];this.changes=[];this.value=b||u(a)}function m(a){a||(a={});
this.dom=a.dom;this.numStores=0;this.list=this.dom?r(this.dom):r();this.frozen=a.frozen;this.organize()}var v,k,w={},q,g,C,z,s="load",D="import"in f.createElement("link");n.prototype.emit=function(){var a,b={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?a=new CustomEvent("byda",b):f.createEvent&&(a=f.createEvent("CustomEvent"),a.initCustomEvent("byda",b.bubbles,b.cancelable,b.detail));x.dispatchEvent(a)};n.prototype.set=function(a,b){var c,d,e;b&&
(d=b.cache);"function"==typeof a?a=a(this.value):"object"==typeof a&&(a=a[this.name]);a||(a=u(this.name)||"");for(c=this.list.length-1;0<=c;c--)e=this.list[c],e.hasAttribute("value")?e.value=a:e.innerHTML=a;this.value=a;d&&(c=this.name,d=this.value,q&&(q["byda-"+c]=d),g&&(g.byda[c]=d));this.emit();return this};n.prototype.get=function(){return this.value};n.prototype.compare=function(a){this.to=a.list[0]};n.prototype.commit=function(a){function b(){a(c.name)}var c=this;if(!this.to)return b();var d,
e,l=y(this.to)?this.to.value||this.to.innerHTML:this.to,f=this.list,g=this.name;l||(l=u(this.name)||"");if("function"==typeof w[this.name])for(d=f.length-1;0<=d;d--)e=f[d].cloneNode(!0),e.innerHTML=l,w[g](f[d],e,b);else this.set(l),b()};m.prototype.update=function(){return this.organize(this.dom?r(this.dom):r())};m.prototype.find=function(a){return this.stores[a]};m.prototype.map=function(a,b){var c,d;for(d in a)(c=this.stores[d])&&c.set(a[d]);return this};m.prototype.generate=function(a){var b,c;
for(c in this.stores)(b=a.stores[c])&&this.stores[c].compare(b);return this};m.prototype.organize=function(a){var b,c;this.stores={};a&&(this.list=a);for(a=this.list.length-1;0<=a;a--)b=this.list[a],c=b.getAttribute("data-"+s),this.frozen&&(b=b.cloneNode(!0)),this.stores[c]||(this.stores[c]=new n(c,b.value||b.innerHTML),this.numStores++),this.stores[c].list.push(b);return this};m.prototype.run=function(a,b){function c(a){e.push(a);d.numStores==e.length&&b()}var d=this,e=[];a=a||p;b=b||p;for(var f in this.stores)this.stores[f].commit(c);
a()};h.init=function(a){a&&(s="string"==typeof a?a:a.suffix=a.data||s,w=a.animation,q=a.local,(g=a.cache)&&!g.byda&&(g.byda={}),z=a.imports,k=a.base,C=a.complete||p)};h.base=function(a){return k=a||k};h.flash=function(a){return new m(a)};x.byda=h})(window,document);