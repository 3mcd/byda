!function(){function h(){return"[data-"+b+"]"}function i(a,b){if(!a)return i.freeze();if("string"==typeof a&&(a={file:a}),a.view&&(a.file="views/"+a.view+".html"),"function"==typeof b&&(a.callback=b),a.json&&(a.json="string"==typeof a.json?{"default":a.json}:a.json,a.json={req:a.json,res:{}}),d&&f){var e=document.createElement("link"),g=c?c+"/"+a.file:a.file;e.rel="import",e.href=g;var h=document.querySelector('link[href="'+g+'"]');h&&h.remove(),e.onload=function(){a.import=e.import,j(a)},e.onerror=function(){l(a)},document.head.appendChild(e)}else j(a)}function j(a){var d,e,b=a.file;if(a.json)if(d=Object.keys(a.json.req)[0])b=a.json.req[d];else if(!b)return a.import?k(a.import,a):m(a);f&&f.readyState<4&&(f.onreadystatechange=g,f.abort());var f=new XMLHttpRequest;b=c?c+"/"+b:b,f.open("GET",b,!0),f.setRequestHeader("X-BYDA","true"),f.onreadystatechange=function(){return 4==f.readyState?200==f.status||0===f.status&&-1!=b.indexOf("file:///")?d?(e=JSON.parse(f.responseText),"default"==d?a.json.res=e:a.json.res[d]=e,delete a.json.req[d],j(a)):(e=f.responseText,k(e,a)):d?(delete a.json.req[d],j(a)):l(a):void 0},f.send()}function k(a,b){var c=i.flash(),d=i.flash({dom:a});c.compare(d),c.commit(),m(b)}function l(a){throw new Error("Could not get: "+a.file)}function m(b){"function"==typeof a&&a(b),b.callback&&b.callback(i.flash(),b.json?b.json.res:null)}function n(a,b){this.from=a,this.to=b}function o(a){this.list=a||[],this.value=this.list[0]}function p(a){return a||(a={}),this.changes=[],this.collections={},this.list=a.dom?i.get(a.dom):i.get(),this.frozen=a.frozen||!1,this.init()}var a,e,b="load",c=window.location.origin,d=!1,f="import"in document.createElement("link"),g=function(){};n.prototype.swap=function(){this.from&&this.to&&(this.from.innerHTML=this.to.innerHTML)},o.prototype.add=function(a){return this.list.push(a),this},o.prototype.get=function(){return this.value},o.prototype.set=function(a){for(_i=0,_len=this.list.length;_len>_i;_i++)this.list[_i].innerHTML=a;return this.value=a,this},p.prototype.init=function(){return this.organize(),this},p.prototype.compare=function(a){var b,c,d,f,g,h;if(a){h=e?e.collections:a.collections;for(var i in h)if(this.collections[i])for(f=e?e.collections[i]:this.collections[i],g=a.collections[i]||f,b=0,c=g.list.length;c>b;b++)d=new n(this.collections[i].list[b],g.list[b]),this.changes.push(d);return a.changes=this.changes,this}},p.prototype.organize=function(a){var c,d,e,f;for(this.collections={},a||(a=this.list),c=0,d=a.length;d>c;c++)f=a[c].getAttribute("data-"+b),e=this.frozen?a[c].cloneNode(!0):a[c],this.collections[f]||(this.collections[f]=new o,this.collections[f].set(e.innerHTML)),this.collections[f].add(e);return this},p.prototype.commit=function(){var a,b;for(a=0,b=this.changes.length;b>a;a++)this.changes[a].swap()},i.init=function(e){if(e){if("string"==typeof e)return b=e,void 0;e.data&&(b=e.data),e.suffix&&(b=e.suffix),e.imports&&(d=e.imports),e.base&&(c=e.base),"function"==typeof e.complete&&(a=e.complete),e.freeze&&this.freeze()}},i.base=function(a){return a&&(c=a),c},i.get=function(a){return a||(a=document),"string"==typeof a&&(a=(new DOMParser).parseFromString(a,"text/html")),a.nodeType?a.querySelectorAll(h()):void 0},i.flash=function(a){return new p(a)},i.freeze=function(){return e=i.flash({frozen:!0})},"undefined"==typeof module?(window.load||(window.load=i),window.byda||(window.byda=i)):module.exports=i}();