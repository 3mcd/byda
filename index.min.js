!function(a,b){function l(a){return a="string"==typeof a?(new DOMParser).parseFromString(a,"text/html"):b,a.nodeType?a.querySelectorAll(m()):void 0}function m(){return"[data-"+i+"]"}function n(a){if(f||e){var b=f?f[a]:e["byda-"+a];return b}}function o(a,b){e["byda-"+a]=b,f&&(f.byda[a]=b)}function p(a,d){if(a)if("string"==typeof a&&(a={file:a}),a.view&&(a.file="views/"+a.view+".html"),a.callback=d,a.json={req:"string"==typeof a.json?[{name:"default",file:a.json}]:a.json||[],res:{}},h&&j){var e=b.createElement("link"),f=a.file;c&&(f=c+"/"+f),e.rel="import",e.href=f;var g=b.querySelector('link[href="'+f+'"]');g&&g.remove(),e.onload=function(){a.import=e.import,q(a)},e.onerror=function(){s(a)},b.head.appendChild(e)}else q(a)}function q(a){var d,b=a.json.req[0],e=b?b.file:a.file;if(!e)return a.import?r(a.import,a):t(a);f&&f.readyState<4&&(f.onreadystatechange=k,f.abort());var f=new XMLHttpRequest;e=c?c+"/"+e:e,f.open("GET",e,!0),f.setRequestHeader("X-BYDA","true"),f.onreadystatechange=function(){if(4==f.readyState)if(b&&a.json.req.splice(0,1),200==f.status||0===f.status&&-1!=e.indexOf("file:///")){var c=f.responseText;if(!b)return r(c,a);d=JSON.parse(c),"default"==b.name?a.json.res=d:a.json.res[b.name]=d,q(a)}else b&&q(a),s(a)},f.send()}function r(a,b){p.flash().generate(p.flash({dom:a})).run(),t(b)}function s(a){throw new Error("Could not get: "+a.file)}function t(a){var b=p.flash();return g&&g(b,a)||a.callback&&a.callback(b,a.json?a.json.res:null)}function u(a,b,c){this.store=a,this.from=b,this.to=c}function v(a,b){this.name=a,this.list=[],this.changes=[],this.value=b||n(a)}function w(a){a||(a={}),this.dom=a.dom,this.list=this.dom?l(this.dom):l(),this.frozen=a.frozen,this.organize()}var c,d,f,g,h,e={},i="load",j="import"in b.createElement("link"),k=function(){};u.prototype.swap=function(){if(this.from&&this.to){var a=this.to.nodeType?this.to.value||this.to.innerHTML:this.to;return a||(a=n(this.store)||""),this.from.hasAttribute("value")?this.from.value=a:this.from.innerHTML=a,this}},v.prototype.emit=function(){var c,d={detail:{name:this.name,value:this.value},bubbles:!0,cancelable:!0};"function"==typeof CustomEvent?c=new CustomEvent("byda",d):b.createEvent&&(c=b.createEvent("CustomEvent"),c.initCustomEvent("byda",d.bubbles,d.cancelable,d.detail)),a.dispatchEvent(c)},v.prototype.set=function(a,b){var c,d,e,f;for(b&&(e=b.cache),"function"==typeof a?a=a(this.value):"object"==typeof a&&(a=a[this.name]),a||(e=!0,a=n(this.name)||""),c=0,d=this.list.length;d>c;c++)f=this.list[c],f.hasAttribute("value")?f.value=a:f.innerHTML=a;this.value=a,e&&o(this.name,this.value),this.emit()},v.prototype.get=function(){return this.value},v.prototype.compare=function(a){var b,c;for(b=0,c=this.list.length;c>b;b++)this.changes.push(new u(this.name,this.list[b],a.list[b]))},v.prototype.commit=function(){var a,b;for(a=0,b=this.changes.length;b>a;a++)this.changes[a].swap()},w.prototype.update=function(){return this.organize(this.dom?l(this.dom):l())},w.prototype.add=function(a,b){return"string"==typeof a&&b.nodeType&&this.find(a).list.push(b),this},w.prototype.find=function(a){return this.stores[a]},w.prototype.map=function(a){var c;for(var d in a)c=this.stores[d],c&&c.set(a[d]);return this},w.prototype.generate=function(a){var b;for(var c in this.stores)b=a.stores[c]||d.stores[c],b&&this.stores[c].compare(b);return this},w.prototype.organize=function(a){var b,c,d,e;for(this.stores={},a&&(this.list=a),b=0,c=this.list.length;c>b;b++)e=this.list[b].getAttribute("data-"+i),d=this.list[b],this.frozen&&(d=d.cloneNode(!0)),this.stores[e]||(this.stores[e]=new v(e,d.value||d.innerHTML)),this.add(e,d);return this},w.prototype.run=function(){for(var a in this.stores)this.stores[a].commit()},p.init=function(a){a&&(i="string"==typeof a?a:a.suffix=a.data||i,e=a.local,f=a.cache,f&&!f.byda&&(f.byda={}),h=a.imports,c=a.base,g=a.complete,a.freeze&&(d=p.flash({frozen:!0})))},p.base=function(a){return c=a||c},p.flash=function(a){return new w(a)},a.byda=p}(window,document);